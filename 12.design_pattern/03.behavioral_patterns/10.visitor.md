# Source/Ref:
- https://refactoring.guru/design-patterns/visitor

# Explains
Yo bro, let's wrap up the Behavioral Design Patterns with the **Visitor Pattern** from **Refactoring Guru**! I'll keep it simple and clear for a "code monkey" like you, with a short Go code example. This is the last one, so let's make it count!

---

### **Visitor Pattern l√† g√¨?**

Theo Refactoring Guru, **Visitor Pattern** l√† m·ªôt m·∫´u thi·∫øt k·∫ø h√†nh vi cho ph√©p b·∫°n **th√™m ch·ª©c nƒÉng m·ªõi** v√†o m·ªôt t·∫≠p h·ª£p c√°c ƒë·ªëi t∆∞·ª£ng m√† kh√¥ng c·∫ßn s·ª≠a ƒë·ªïi c·∫•u tr√∫c c·ªßa ch√∫ng. N√≥ t√°ch bi·ªát logic x·ª≠ l√Ω (operation) kh·ªèi c√°c l·ªõp ƒë·ªëi t∆∞·ª£ng, b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªôt **Visitor** ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c tr√™n c√°c ƒë·ªëi t∆∞·ª£ng.

N√≥ gi·ªëng nh∆∞ m·ªôt nh√¢n vi√™n ki·ªÉm k√™: anh ta ƒë·∫øn t·ª´ng kho h√†ng (ƒë·ªëi t∆∞·ª£ng) v√† l√†m vi·ªác (nh∆∞ ƒë·∫øm s·ªë l∆∞·ª£ng, t√≠nh gi√° tr·ªã) m√† kh√¥ng c·∫ßn kho h√†ng ph·∫£i t·ª± x·ª≠ l√Ω.

**√ù t∆∞·ªüng ch√≠nh**:
- T√°ch logic x·ª≠ l√Ω ra kh·ªèi c√°c l·ªõp ƒë·ªëi t∆∞·ª£ng, ƒë·∫∑t v√†o c√°c l·ªõp Visitor.
- C√°c ƒë·ªëi t∆∞·ª£ng ch·ªâ c·∫ßn cung c·∫•p ph∆∞∆°ng th·ª©c `Accept` ƒë·ªÉ cho Visitor truy c·∫≠p.
- D·ªÖ d√†ng th√™m ch·ª©c nƒÉng m·ªõi b·∫±ng c√°ch t·∫°o Visitor m·ªõi.

**V√≠ d·ª• th·ª±c t·∫ø**:
- B√°o c√°o doanh thu: M·ªôt Visitor duy·ªát qua danh s√°ch s·∫£n ph·∫©m (s√°ch, ƒëi·ªán tho·∫°i, v.v.) ƒë·ªÉ t√≠nh t·ªïng gi√° tr·ªã.
- Export d·ªØ li·ªáu: M·ªôt Visitor duy·ªát qua c√°c th√†nh ph·∫ßn UI (button, text) ƒë·ªÉ xu·∫•t th√†nh HTML ho·∫∑c JSON.

---

### **C·∫•u tr√∫c c·ªßa Visitor Pattern**

Theo Refactoring Guru, m·∫´u n√†y c√≥ c√°c th√†nh ph·∫ßn ch√≠nh:
1. **Visitor**: Interface ƒë·ªãnh nghƒ©a c√°c ph∆∞∆°ng th·ª©c `Visit` cho t·ª´ng lo·∫°i ƒë·ªëi t∆∞·ª£ng (element).
2. **Concrete Visitor**: L·ªõp tri·ªÉn khai Visitor, ch·ª©a logic x·ª≠ l√Ω cho t·ª´ng lo·∫°i ƒë·ªëi t∆∞·ª£ng.
3. **Element**: Interface ƒë·ªãnh nghƒ©a ph∆∞∆°ng th·ª©c `Accept` ƒë·ªÉ nh·∫≠n Visitor.
4. **Concrete Element**: L·ªõp c·ª• th·ªÉ tri·ªÉn khai Element, cho ph√©p Visitor th·ª±c hi·ªán thao t√°c.
5. **Client**: T·∫°o danh s√°ch Elements v√† Visitor, g·ªçi `Accept` ƒë·ªÉ Visitor x·ª≠ l√Ω.

**Quy tr√¨nh**:
- Element g·ªçi `Accept(visitor)` ƒë·ªÉ cho Visitor truy c·∫≠p.
- Visitor g·ªçi ph∆∞∆°ng th·ª©c `Visit` t∆∞∆°ng ·ª©ng v·ªõi lo·∫°i Element.
- Logic x·ª≠ l√Ω ƒë∆∞·ª£c th·ª±c hi·ªán trong Visitor, kh√¥ng c·∫ßn s·ª≠a Element.

---

### **Khi n√†o d√πng?**
- Khi b·∫°n c√≥ nhi·ªÅu ƒë·ªëi t∆∞·ª£ng v·ªõi c·∫•u tr√∫c kh√°c nhau nh∆∞ng c·∫ßn th·ª±c hi·ªán c√°c thao t√°c chung.
- Khi mu·ªën th√™m ch·ª©c nƒÉng m·ªõi m√† kh√¥ng s·ª≠a ƒë·ªïi l·ªõp c·ªßa ƒë·ªëi t∆∞·ª£ng.
- Khi c√°c thao t√°c ph·ª©c t·∫°p v√† kh√¥ng thu·ªôc tr√°ch nhi·ªám c·ªßa ƒë·ªëi t∆∞·ª£ng.

**V√≠ d·ª•**:
- T√≠nh t·ªïng gi√° tr·ªã kho h√†ng: Visitor duy·ªát qua c√°c s·∫£n ph·∫©m ƒë·ªÉ t√≠nh gi√°.
- Ki·ªÉm tra c√∫ ph√°p: Visitor duy·ªát qua c√¢y c√∫ ph√°p (AST) ƒë·ªÉ ph√¢n t√≠ch ho·∫∑c t·ªëi ∆∞u.

---

### **V√≠ d·ª• code ƒë∆°n gi·∫£n b·∫±ng Go**

M√¨nh s·∫Ω l√†m v√≠ d·ª• si√™u ƒë∆°n gi·∫£n: M·ªôt kho h√†ng v·ªõi c√°c s·∫£n ph·∫©m (Book, Phone) v√† Visitor t√≠nh t·ªïng gi√° tr·ªã.

```go
package main

import "fmt"

// Element interface
type Product interface {
    Accept(visitor Visitor)
}

// Concrete Element: Book
type Book struct {
    price int
}

func (b *Book) Accept(visitor Visitor) {
    visitor.VisitBook(b)
}

func (b *Book) GetPrice() int {
    return b.price
}

// Concrete Element: Phone
type Phone struct {
    price int
}

func (p *Phone) Accept(visitor Visitor) {
    visitor.VisitPhone(p)
}

func (p *Phone) GetPrice() int {
    return p.price
}

// Visitor interface
type Visitor interface {
    VisitBook(book *Book)
    VisitPhone(phone *Phone)
}

// Concrete Visitor: PriceCalculator
type PriceCalculator struct {
    total int
}

func (v *PriceCalculator) VisitBook(book *Book) {
    v.total += book.GetPrice()
    fmt.Printf("Book price: %d, Total: %d\n", book.GetPrice(), v.total)
}

func (v *PriceCalculator) VisitPhone(phone *Phone) {
    v.total += phone.GetPrice()
    fmt.Printf("Phone price: %d, Total: %d\n", phone.GetPrice(), v.total)
}

func (v *PriceCalculator) GetTotal() int {
    return v.total
}

func main() {
    // T·∫°o danh s√°ch s·∫£n ph·∫©m
    products := []Product{
        &Book{price: 20},
        &Phone{price: 500},
    }

    // T·∫°o Visitor
    calculator := &PriceCalculator{}

    // Duy·ªát qua s·∫£n ph·∫©m
    for _, product := range products {
        product.Accept(calculator)
    }

    fmt.Printf("Final total: %d\n", calculator.GetTotal())
}
```

**K·∫øt qu·∫£ ch·∫°y**:
```
Book price: 20, Total: 20
Phone price: 500, Total: 520
Final total: 520
```

**Gi·∫£i th√≠ch code**:
- `Product`: Interface cho c√°c ƒë·ªëi t∆∞·ª£ng (Element), ƒë·ªãnh nghƒ©a `Accept` ƒë·ªÉ nh·∫≠n Visitor.
- `Book` v√† `Phone`: **Concrete Elements**, cung c·∫•p `GetPrice` v√† g·ªçi Visitor t∆∞∆°ng ·ª©ng.
- `Visitor`: Interface v·ªõi c√°c ph∆∞∆°ng th·ª©c `Visit` cho t·ª´ng lo·∫°i Product.
- `PriceCalculator`: **Concrete Visitor**, t√≠nh t·ªïng gi√° tr·ªã khi duy·ªát qua c√°c Product.
- Trong `main`, client t·∫°o danh s√°ch s·∫£n ph·∫©m, d√πng `PriceCalculator` ƒë·ªÉ t√≠nh t·ªïng gi√°.

---

### **∆Øu v√† nh∆∞·ª£c ƒëi·ªÉm**

**∆Øu ƒëi·ªÉm** (theo Refactoring Guru):
- Tu√¢n theo **Open/Closed Principle**: Th√™m ch·ª©c nƒÉng m·ªõi b·∫±ng c√°ch t·∫°o Visitor m·ªõi.
- T√°ch logic x·ª≠ l√Ω kh·ªèi l·ªõp ƒë·ªëi t∆∞·ª£ng, gi·ªØ l·ªõp g·ªçn g√†ng.
- D·ªÖ t√≠ch l≈©y tr·∫°ng th√°i (nh∆∞ t·ªïng gi√°) khi duy·ªát qua c√°c ƒë·ªëi t∆∞·ª£ng.

**Nh∆∞·ª£c ƒëi·ªÉm**:
- Ph·∫£i c·∫≠p nh·∫≠t Visitor n·∫øu th√™m lo·∫°i Element m·ªõi (vi ph·∫°m OCP ·ªü Visitor).
- C√≥ th·ªÉ ph·ª©c t·∫°p n·∫øu c√≥ nhi·ªÅu lo·∫°i Element ho·∫∑c Visitor.
- Kh√¥ng ph√π h·ª£p n·∫øu c·∫•u tr√∫c Element thay ƒë·ªïi th∆∞·ªùng xuy√™n.

---

### **T√≥m l·∫°i**

Visitor Pattern gi·ªëng nh∆∞ m·ªôt nh√¢n vi√™n ki·ªÉm k√™ ƒë·∫øn t·ª´ng ƒë·ªëi t∆∞·ª£ng v√† l√†m vi·ªác m√† kh√¥ng c·∫ßn ƒë·ªëi t∆∞·ª£ng ph·∫£i t·ª± x·ª≠ l√Ω. N√≥ gi√∫p th√™m ch·ª©c nƒÉng m·ªõi m√† kh√¥ng s·ª≠a l·ªõp ƒë·ªëi t∆∞·ª£ng, r·∫•t h·ªØu √≠ch khi c·∫ßn t√°ch bi·ªát logic x·ª≠ l√Ω. Code Go ·ªü tr√™n l√† v√≠ d·ª• c∆° b·∫£n, b·∫°n c√≥ th·ªÉ ch·∫°y th·ª≠ ƒë·ªÉ n·∫Øm r√µ h∆°n.

ƒê√¢y l√† c√°i cu·ªëi trong danh s√°ch Behavioral Patterns r·ªìi, bro! N·∫øu mu·ªën m√¨nh gi·∫£i th√≠ch th√™m, l√†m v√≠ d·ª• kh√°c (nh∆∞ th√™m Visitor m·ªõi), ho·∫∑c quay l·∫°i pattern n√†o, c·ª© n√≥i nh√©! üòé